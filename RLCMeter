RLCMeter

Измеряем напряжение на элементе и ток на сопротивлении которое последовательно с ним стоит.

R = 1/(2*PI*F*C)
R = (2*PI*F*L)

import math
def RFC(F,C): return 1/(2*math.pi*F*C)
def RFL(F,L): return 2*math.pi*F*L

F = 50 kHz
C = 1 mkF R = 3 Om
C = 1 nF R = 3 KOm
C = 1 pF R = 3 MOm

L = 1 mH R = 3 Om
L = 1 mkH R = 0.3 Om
L = 1 nH R = 0.3 mOm

F = 100 Hz
C = 1000 mkF R = 1.6 Om
C = 100 mkF R = 16 Om

L = 1 KH R = 628 KOm
L = 1 H R = 628 Om
L = 1 mH R = 0.6 Om

Теперь прикинем напряжение, какое можем измерять.
3.3 V напряжение измеряемое ADC
Максимальный коэффициэнт усиления 32
0.1 V при максимальном коэффициэнте
10 mA максимальный ток

100 Om == 0.1 V

Значит предусилитель x10 обязательно нужен.

Возможно лучше таки сделать "инструментальный" вариант, где резисторы переключаются с использованием реле.
74HC4052 c 100 ом проходного сопротивления - это всетаки несколько экстремально.
Это конечно несколько экстенсивно, зато позволит достаточно точно контролировать емкость параллельную сопротивлению.

Перед выходным усилителем таки сделать гальваническую развязку, это позволит избавиться от цепи подгонки постоянной составляющей напряжения.
Гальваническая развязка это не очень хорошо, потому как если будем измерять большое сопротивление, то постоянная составляющая долго может устаканиваться.

По выводам
74HC4052 == 4052
AD8532 == LM358

----------------------------
Пусть резисторы переключаются посредством 74HC4052, это экономично и мало места займет.
Пусть вход инструментального усилителя переключается посредством реле. Возьмем реле с двумя группами контактов.

Питать будем пока от USB, а в дальнейшем от батареек 6 V.
AD8532 - используем как обычные ОУ
AD8221 - инструментальный усилитель, пускай всегда усиливает в 1 и 20 раз.
MCP6S21 - усилитель с программируемым коэффициэнтом усиления 1..32 раза.

300 mV напряжение на выходе усилителей.

---------------------------

Добрый день. Понравилась мне схема RLC измерителя на STM32F100. Но как собственно и указал автор есть некоторые проблеммы в аналоговой части. Поэтому хочу сделать более качественно. Пока подготавливаюсь потихоньку как с теоретической так и с практической части. 

Сначала про замеченные недостатки в оригинальной схеме.
Рассмотрим фильтр нижних частот/буферный усилитель на микросхемах DA2:1 DA4:1. Первый недостаток - это PWM модуляция. По моему опыту это даст огромные наводки на ADC внутри процессора. Второй недостаток - DA2:1 и DA2:2 это части одной микросхемы, но одна DA2:1 находится в части схемы с большой амплитудой сигнала, а DA2:2 - в части с малой амплитудой сигнала.

Посмотрим на DA4:2, тут аналогичный недостаток - будут наводки от DA4:1. К томуже на выходе DA4:2 нет блокировочного конденсатора. Если учесть, что выход DA4:2 это "виртуальная земля", то конденсантор там важен.

Схема инструментального усилителя на DA1:1 DA1:2 DA3:1 довольно сложна и как указал автор - излишне сильно шумит.

Поэтому представляю свой вариант аналоговой части (см Вложения). Цифровую часть пока не прорисовывал.

Там где требуются усилители с мощными выходами применил AD8532. Фильтра нижних частот/буфер на IC1A, IC1B оставил практически без изменений. Но поставил между ними разделительный конденсатор и привязал IC1B по постоянному току к "виртуальной земле". Теортетически это должно избавить от проблемм с постоянной составляющей напряжения на выходе IC1B. Разделительный конденсатор на выходе IC1B ставить нельзя, потому как мы можем измерять элемент с высоким сопротивлением или вообще конденсатор.

IC3A обеспечивает нам "виртуальную" землю. Но в отличие от оригинальной схемы выбрал питающее напряжение побольше (+2.5V), чтобы операционным усилителям было попроще работать в линейном режиме. На выходе поставил элементы R8, C7, C8 для фильтрации высокочастотного шума.

Выбор сопротивления оставил без изменения на элементах IC3B IC2.

Переключатель ток/напряжение на входе инструментального усилителя нарисовал на 74HC4066. Потому как не оказалось 74HC4053 у меня в наличии, в будущем возможно и перерисую обратно. Логика работы этого узла не изменилась - для того чтобы сигнал проходил. Надо IC4A, IC4D - включить. IC4B - выключить. 
Заземлять серединку нужно для того, чтобы даже минимального сигнало не прошло через проходные емкости.

Инструментальный усилитель выбрал AD8221. У него довольно низкий уровень шума. Схема становится проще. Пусть будет два коэффициэнта усиления 1:1 и 1:20.

Оконечный усилитель пускай будет на MCP6S21. Это операционный усилитель, с программируемыми коэффициэнтами усиления от 1:1 до 1:32.

Заказал LCR Meter DE-5000 чтобы таки был шанс настроить хорошо. Например к узлу переключающему сопротивления много вопросов, а какое он таки сопротивление имеет на разных частотах.

Замечания? Дополниения? Умные мысли?